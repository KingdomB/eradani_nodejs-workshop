# POWERUp2019 Node.js Workshop

## Node.js

---

### **Introduction**

Node.js is perhaps one of the most popular technologies in the world today, used by many Fortune 500 companies to automate internal processes, // TODO: SOMETHING, and operate as a web server. In fact, Node.js is supported by many large organizations such as IBM, Google, Microsoft, and Joyent, who strive to enable widespread adoption of Node.js and ensure that it is viable for enterprise-level workflows. (To learn more, see the [Node.js Foundation](https://foundation.nodejs.org/)).

Luckily, Node.js is fully supported on the IBM i, allowing you to utilize its power to extend the capabilities of your current applications in ways you never thought possible. Although it may seem scary and foreign at first, with a little practice you will soon see that Node.js is really quite simple to use, and allows you to develop modern programs on your IBM i faster than you ever thought possible.

### **What is Node.js?**

At its core, Node.js (sometimes just called _Node_) is a JavaScript runtime that executes your JavaScript code using Google's Chrome V8. In the past, JavaScript was primarily run in the browser (which commonly runs Chrome V8 as well), but now it can be run in an runtime environment similar to Java or Python that allows you to use JavaScript similar to how you would run other code and interact with things like your file system, databases, create HTTP calls, or call C and C++ programs.

The power of Node.js is that it allows you to use JavaScript (an incredibly flexible and easy-to-learn leanguage) to do more than just manipulate HTML and CSS in the browser, and indeed you can do nearly everything with Node.js that you are acustomed to doing in C, C++, or RPG. In fact, IBM has developed Node.js packages that allow you to call all of the RPG programs, SQL procedures, CL and QSH commands, and much more that you have invested a lot of time and money in, allowing Node.js to build on the work that you have already done. We will talk more about how IBM's packages allow interaction between the Node.js runtime and OS400 more below, but for now know that it is very easy to use Node.js to integrate Node.js with the software you have already built on the IBM i.

Node.js ships with APIs that can be used without an extension, such as `http` to interact with the internet, `fs` to manipulate the file system, `os` to interact with the operating system, or `path` for working with file paths. In reality, you often do not have to call Node.js native APIs directly, as you will be using packages which wrap around these APIs and create their own easy-to-understand API tooled for a particular purpose. We will talk more about packages below. // TODO: Link

In all of our JavaScript examples in the previous section, we have been using Node.js to execute our code. 

Node.js exposes

There are a number of things that are important to know about Node.js in order to get the most out of 

#### Single-threaded Event Loop

Perhaps the most the most important thing to know about Node.js is that it is **single-threaded**.



* V8 JavaScript runtime environment
* Runs your JavaScript outside of a browser, but has other capabilites
* APIs exposed that do things like file management, encryption, propogate errors, etc.
* Single-threaded, need to use asynchronous workers
* We've been using it in the previous examples!

### **How to Install Node.js (on the IBM i)**

* Refer back to setup?

---

### **How to use Node.js**

* using `node <file.js>` to run your program with Node
* Maybe some other interesting things here? Not sure how else to use it...

---

### **npm: The Node Package Manager**

![alt text](npm.png "Logo Title Text 1")

One of the most compelling reasons to use Node.js is npm, The Node Package Manager. npm is a repository of over 940,000 open-source Node.js packages have been developed by members of the community, and can be found at [https://www.npmjs.com/](https://www.npmjs.com/). This makes npm the largest code repository in the entire world! To browse the packages available, simply visit the website and search in the bar for either the package name or by keywords.

The packages on range in size and scope from single-line functions that do very spcific data testing or manipulation, to entire frameworks for creating web servers and creating API endpoints. Many packages are updated very frequently and have tens of millions of downloads every week. As an example, the most popular package on npm, `lodash`, is a utility library that has 21 million weekly downloads.

Because these packages are open-source, you can go to any package, click on the link to its code repository, and see all of the code that is used to build the package. This allows you 

The best part of npm is that a lot of the boring, hard-to-implement functionality of software has already been done for you, allowing you to focus instead on writing the application logic for your business or project.

---

### **The `npm` utility**

When you download Node.js, in addition to the `node` command you also get the `npm` command. The `npm` utility helps install packages from [https://www.npmjs.com/](https://www.npmjs.com/) and manage the metadata for your program (e.g. version number, author name, specifying scripts, etc.).

When you create a Node.js project, usually the first thing you do is go to your project's directory and running `npm init`. This command will create a file called `package.json` that will store all of the metadata for your application. Although you don't _have_ to run `npm init` or even have a `package.json` to use Node.js, you will have to use it if you want to either

1. Push your package to be available on npm
2. Download any packages from npm using the `npm install` command.

So if `npm init` creates `package.json`, what does `package.json` do?// TODO:
* What is `package.json`
* How to install packages with `npm install`

---

### **IBM i Node.js Packages**

The IBM i Open-Source Software Team has developed a number of packages that allow you to interact with your IBM i, either from a Node.js runtime running on your IBM i or from another system.

* **`itoolkit`**: A package that uses the IBM i XMLSERVICE to enable calls into your IBM i. Some of the things could can do with itoolkit includes calling programs, CL or QSH commands, running SQL, and many more things you are accustomed to doing in 5250. To download, run `npm install itoolkit`. More information about the package can be found at: [https://www.npmjs.com/package/itoolkit](https://www.npmjs.com/package/itoolkit)
* **`idb-connector`**: A database connector that creates a simple API for communicating with Db2 on the IBM i. **idb-connector can only be run on a Node.js instance on the IBM i, not a Node.js instance calling to a remote IBM i.** To download, run `npm install idb-connector`. More information about the package can be found at: [https://www.npmjs.com/package/idb-connector](https://www.npmjs.com/package/idb-connector).
* **`idb-pconnector`**: A wrapper for `idb-pconnector` that converts the API to use native JavaScript `Promises` instead of callback functions, and also comes with connection pooling. Like `idb-connector`, it can only be run on IBM i. To download, run `npm install idb-pconnector`. More information about the package can be found at [https://www.npmjs.com/package/idb-pconnector](https://www.npmjs.com/package/idb-pconnector).
* **`odbc`**: Our latest database connector, ODBC is platform (and database management system) agnostic and allows you to connect to your IBM i from any system granted that you have an ODBC driver. It also can be used directly on the IBM i. To download, run `npm install odbc@beta` // TODO: make sure this is right. Unlike the other packages listed here, this package is not IBM i-specific, and the IBM i Open-Source Software team only recently assumed leadership over the project. However, this package will be the future of database connection on the IBM i, and so it might be best to set up your ODBC environment sooner rather than later. More information about the package can be found at: [https://www.npmjs.com/package/odbc](https://www.npmjs.com/package/odbc).

---

### **Your First (Real) Node.js Application**

Although our previous examples were run using Node.js, lets create an application that actually uses the power of `npm` to download a package
* use `npm init` to create your application
* Download a package or two
* require the packages in the main file
* run something interesting using JavaScript skills

---

## **Conclusion**

Node.js may seem confusing at first, but it is really quite simple technology. Node.js itself is nothing more than a runtime that allows you to write programs in JavaScript, a weakly-typed and interpreted language, while also exposing access to things like the file system and http methods. The real power of Node.js comes from the hundreds of thousands of open-source packages hosted on npmjs.com that allow you to use someone else's hard work to implement functionality in your program. This allows you to focus primarily on your business logic and not on reinventing the wheel. IBM has invested money and development resources not just in making sure that Node.js is an enterprise-level tool, but also so that it has a robust suite of packages to interact with the IBM i.