# **POWERUp2019 Node.js Workshop**

## iToolKit

### Intro to iToolKit

Congratulations on getting this far! With all of the material you've covered, you're now ready to hit the real purpose of this lab: getting the latest, cutting-edge, open-source technologies to interact with existing IBM i applications. In this section, we will move our Express server over to our IBM i LPARs and set the servers up to **interact directly with DB2 on the i!** This process will effectively generalize to any other commands available on your IBM i, meaning that once this section is complete, you will have all of the basic tools required for your IBM i applications to tap into the world open-source web technology!

We will achieve this using a wonderful open-source tool called iToolKit. **This toolkit is available on NPM, but we use a slightly modified version for this lab, available at this github repo, provided by our own Dave Romo: `github:dromonaco/nodejs-itoolkit`. 

The first step is to get set up on the LPARs, which we will take some time now to set up. During this point in the workshop, we will be distributing all of the necessary information for connecting to your LPAR's PASE environment and starting up Node there for development. **We will move on to the next section once this process is complete, so please bear with us for a few minutes.**

---

### Moving Our Server Over to the i

Now that we have Node up and running, we are going to move our Express applications from the previous section of the workshop to the i. We need two files for this: a `package.json` file and the main `app.js` file, both of which are provided below. In your terminal, you will need to create these two files and copy/paste their respective code into them.

You can create the files with the following two commands:

```bash
touch package.json
touch app.js
```

Then, you can manually retype the contents of each file or copy/paste them. If you decide to copy/paste them, copy the contents for the `package.json` file now (available below), then open up the `package.json` file in a text editor with the following command:

```bash
nano package.json
```

Once you have pasted or retyped the contents of the file, press `Ctrl+O` and then `Enter` to save the file, then `Ctrl+X` to exit the editor. Now repeat for the `app.js` file.

**In the app.js file, don't forget to set the port number for your application!** In the final line of app.js, you will see `server.listen('<REPLACE THIS STRING WITH YOUR PORT NUMBER>');`. You have been provided with a port number - please replace the entire text string with that number (including the quotes). For example, if your port number is `2019`, then the line should be: `server.listen(2019);`.

`package.json`
```json
{
  "name": "common-workshop",
  "version": "1.0.0",
  "description": "",
  "main": "app.js",
  "dependencies": {
    "express": "^4.16.4",
    "request": "^2.88.0",
    "request-promise": "^4.2.4"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

`app.js`
```javascript
const http = require('http');
const express = require('express');

const requestPromise = require('request-promise');

const app = express();

app.get('/', function(request, response) {
    response.end('Hello Internet!');
});

app.get('/hello', function(request, response) {
    response.end('Hello, ' + request.query.name);
});

app.get('/data', function (request, response) {
    requestPromise('https://jsonplaceholder.typicode.com/todos/1')
        .then(result => {
            console.log(result);
            response.end(result);
        })
        .catch(error => {
            console.log(error);
            response.status(500).end(error);
        });
})

const server = http.createServer(app);

server.listen('<REPLACE THIS STRING WITH YOUR PORT NUMBER>');
```

Once you have copied the two files, you will need to install the NPM dependencies with the following command:

```bash
npm install
```

**This command may take a bit to run.**

Once it completes, run your Node application with `node app.js`.

You should then be able to navigate to the URL of the LPAR, followed by your port number in your browser to see "Hello Internet!". The URL will follow this format: `http://<LPAR_IP_ADDRESS>:<PORT>/`. For example, if the LPAR address was `www.yourlpar.com` and the port was `2019`, the full URL would be `http://www.yourlpar.com:2019/`.

If you see "Hello Internet!" in your browser, congratulations! You now have a Node application running on the IBM i! In the next section, we will change our '/data' route so that it retrieves real data from the DB2 database on the i.